{"meta":{"title":"Z's blog","subtitle":"最可怕一生碌碌无为，还说平凡难能可贵！","description":null,"author":"Z","url":"https://zealforbeing.github.io"},"pages":[{"title":"关于我","date":"2018-03-22T08:10:20.000Z","updated":"2018-03-22T08:57:35.000Z","comments":false,"path":"about/index.html","permalink":"https://zealforbeing.github.io/about/index.html","excerpt":"","text":""},{"title":"分类","date":"2018-03-22T08:04:11.000Z","updated":"2018-03-22T08:51:38.148Z","comments":false,"path":"categories/index.html","permalink":"https://zealforbeing.github.io/categories/index.html","excerpt":"","text":""},{"title":"tags","date":"2018-03-22T07:56:32.000Z","updated":"2018-03-22T08:02:10.910Z","comments":true,"path":"tags/index.html","permalink":"https://zealforbeing.github.io/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"视频播放简单原理","slug":"视频播放简单原理","date":"2018-04-12T01:38:00.000Z","updated":"2018-04-12T03:59:26.000Z","comments":true,"path":"2018/04/12/视频播放简单原理/","link":"","permalink":"https://zealforbeing.github.io/2018/04/12/视频播放简单原理/","excerpt":"","text":"前言 视频播放基本流程 基本概念 常用流媒体协议 常用封装 视频编码 音频编码 音画同步 后话 参考 前言前段时间做了一个直播模块，没有意外都是用第三方服务实现的，基本都是业务的东西，有时间就开始研究下相关的技术，不能一直做黑盒程序猿啊。这篇文章主要是记录视频播放的简单原理，很多内容都是摘录自雷神等人的博客，希望不会被怪罪。想要深入研究很推荐去雷神的专栏看一下(https://blog.csdn.net/leixiaohua1020)，在此缅怀这位无私智者。 视频播放基本流程图1、视频播放流程图 解协议：将流媒体协议的数据，解析为标准的相应的封装格式数据，常用协议：HTTP、RTMP、MMS等； 解封装：将输入的封装格式的数据，分离成为音频流压缩编码数据和视频流压缩编码数据，常见视频格式：MP4、MKV、FLV、RMVB等 解码（视、音频解码）：将视频/音频压缩编码数据，解码成为非压缩的视频/音频原始数据，常见解码：视频编码H264-&gt;像素数据YUV/RGB、音频编码AAC-&gt;采样数据PCM 音画同步：根据解封装模块处理过程中获取到的参数信息，同步解码出来的视频和音频数据，并将视频音频数据送至系统的显卡和声卡播放出来，以FFmpeg库为例，利用时间戳去同步二者：PTS（Presentation Time Stamp 显示时间戳）、DTS（Decoding Time Stamp 解码时间戳）； 终端设备播放：显卡、声卡对视音频的输出。 基本概念 分辨率：指每一帧画面的大小,宽乘高等于若干像素。目前主流的高清格式通常为：720p（1280×720）、1080p（1920×1080）、2K（2560x1440）、4K（4096×2160） 码率（比特率，bit per second / bps / bit rate）：指单位时间传输的或解码的位数。码率越大，说明单位时间内取样率越大，数据流精度就越高，这样表现出来的的效果就是：视频画面更清晰画质更高。 帧率（frames per seconds / fps）：指播放时每秒移动多少帧。通常说一个视频的25帧，指的就是这个视频帧率，即1秒中会显示25帧；视频帧率影响的是画面流畅感，也就是说视频帧率超高，表现出来的效果就是：画面越显得流畅。一般NTSC①是30,PAL②是25，帧速太低则画面不连续播放的流畅性就差，所以要恰到好处才行。 采样率（sample rate）：指每秒采集的次数，这个是指音频的，采的越多，声音质量越好，当然体积也会大。 码率影响体积，与体积成正比；码率越大，体积越大；码率越小，体积越小。帧率影响画面流畅度，与画面流畅度成正比：帧率越大，画面越流畅；帧率越小，画面越有跳动感。如果码率为变量，则帧率也会影响体积，帧率越高，每秒钟经过的画面越多，需要的码率也越高，体积也越大。分辨率影响图像大小，与图像大小成正比：分辨率越高，图像越大；分辨率越低，图像越小。 常用流媒体协议不管是观看视频还是直播，大多数都需要通过网络传播，服务器与客户端都需要遵循一定的协议才能实现数据的传输与解析。目前已经有很多流媒体协议（如表1所示），各有优劣，将来还会有更多的机构制定、推出不同的协议，以解决现有的问题。基于TCP的协议传输可靠，但是会有抖动、延迟等问题。基于UDP的协议虽然抖动和延迟情况会好些，但是不够可靠存在丢包的情况。所以不能说哪个协议最好，只能根据自身业务需求选择一种适合的协议，亦或是自行制定协议，在封装可靠的UDP连接等。 表1、常见流媒体协议 名称 推出机构 传输层协议 客户端 目前使用领域 RTSP+RTP IETF TCP+UDP VLC, WMP IPTV RTMP Adobe Inc. TCP Flash 互联网直播 RTMFP Adobe Inc. UDP Flash 互联网直播 MMS Microsoft Inc. TCP/UDP WMP 互联网直播+点播 HTTP WWW+IETF TCP Flash 互联网点播 HLS Apple Inc. TCP iOS, macOS 互联网直播+点播 常用封装一般我们所说的视频包括画面和声音，二者分开的话顶多算是图片和音频，封装便是把画面和声音打包到一起组成视频文件，解封装便是打包的逆过程，将画面和声音分开，播放是交给不同的设备输出。视频封装同样有很多格式，平时都是以文件后缀就可以区分，如常见的：.mp4、.flv、.rmvb等等。支持不同的音视频编码决定其最终的画质和音质；支持流媒体协议与否，决定其能不能以流媒体形式传输。 表2、常见视频封装格式 名称 推出机构 流媒体 支持的视频编码 支持的音频编码 目前使用领域 AVI Microsoft Inc. 不支持 几乎所有格式 几乎所有格式 BT下载影视 MP4 MPEG 支持 MPEG-2, MPEG-4, H.264, H.263等 AAC, MPEG-1 Layers I, II, III, AC-3等 互联网视频网站 TS MPEG 支持 MPEG-1, MPEG-2, MPEG-4, H.264 MPEG-1 Layers I, II, III, AAC, IPTV，数字电视 FLV Adobe Inc. 支持 Sorenson, VP6, H.264 MP3, ADPCM, Linear PCM, AAC等 互联网视频网站 MKV CoreCodec Inc. 支持 几乎所有格式 几乎所有格式 互联网视频网站 RMVB Real Networks Inc. 支持 RealVideo 8, 9, 10 AAC, Cook Codec, RealAudio Lossless BT下载影视 视频编码如果视频中每一帧的画面都是原图片的话，最后生成的视频将是巨大的。在一些视频中往往会有一段时间，画面的大部分内容都是相同的，这个时候就可以进行前后画面的对比，进行一定的压缩操作以达到节省空间的作用，这种压缩操作就是视频编码。不同的压缩算法，就产生了不同的编码格式，应用的比较广泛的就是H.264了，接下来也会深入的去学习一下。 表3、常见视频编码 名称 推出机构 推出时间 目前使用领域 HEVC(H.265) MPEG/ITU-T 2013 研发中 H.264 MPEG/ITU-T 2003 各个领域 MPEG4 MPEG 2001 不温不火 MPEG2 MPEG 1994 数字电视 VP9 Google 2013 研发中 VP8 Google 2008 不普及 VC-1 Microsoft Inc. 2006 微软平台 音频编码音频编码和视频编码的道理一个样，对原始音频数据的压缩，为的也是节省空间，AAC和MP3应用广泛。 表4、常见音频编码 名称 推出机构 推出时间 目前使用领域 AAC MPEG 1997 各个领域（新） AC-3 Dolby Inc. 1992 电影 MP3 MPEG 1993 各个领域（旧） WMA Microsoft Inc. 1999 微软平台 音画同步音视频是不同设备去采集，音视频编码解码时间不一致，流媒体传输将音视频分开传输等等原因，不作处理，声音和画面播放往往是不同步的，直接播放肯定是没法看的。采集的时候需要给每个视频帧和音频样本加上时间戳，再通过一个基准将音画进行同步处理，解决方案有如下几种： 将视频同步到音频上，就是以音频的播放速度为基准来同步视频。视频比音频播放慢了，加快其播放速度；快了，则延迟播放。 将音频同步到视频上，就是以视频的播放速度为基准来同步音频。 将视频和音频同步外部的时钟上，选择一个外部时钟为基准，视频和音频的播放速度都以该时钟为标准。 后话经过一段时间的学习，反反复复看雷神的博客，写了些代码实践验证，音视频这个领域广度和深度是我无法想象的，还是要靠慢慢的积累。文中有什么错误和不足欢迎指正。 参考《视音频编解码技术零基础学习方法》《FFMPEG编码：参数研究》《FFmpeg学习6：视音频同步》","categories":[{"name":"iOS","slug":"iOS","permalink":"https://zealforbeing.github.io/categories/iOS/"}],"tags":[{"name":"音视频","slug":"音视频","permalink":"https://zealforbeing.github.io/tags/音视频/"}],"keywords":[{"name":"iOS","slug":"iOS","permalink":"https://zealforbeing.github.io/categories/iOS/"}]},{"title":"iOS知识梳理","slug":"iOS知识梳理","date":"2018-03-26T09:36:21.000Z","updated":"2018-03-27T01:48:22.646Z","comments":true,"path":"2018/03/26/iOS知识梳理/","link":"","permalink":"https://zealforbeing.github.io/2018/03/26/iOS知识梳理/","excerpt":"","text":"","categories":[{"name":"iOS","slug":"iOS","permalink":"https://zealforbeing.github.io/categories/iOS/"}],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://zealforbeing.github.io/tags/iOS/"}],"keywords":[{"name":"iOS","slug":"iOS","permalink":"https://zealforbeing.github.io/categories/iOS/"}]},{"title":"博客的艰难部署过程","slug":"博客的艰难部署过程","date":"2018-03-22T06:15:05.000Z","updated":"2018-03-26T09:11:57.429Z","comments":true,"path":"2018/03/22/博客的艰难部署过程/","link":"","permalink":"https://zealforbeing.github.io/2018/03/22/博客的艰难部署过程/","excerpt":"","text":"Hexo + GitHub Pages 搭建个人博客 Hexo + GitHub Pages 搭建个人博客 1. 前言 2. 搭建步骤 3. 搭建 Node.js 环境 4. 搭建Git环境 &amp; GitHub注册和配置 5. 安装配置 Hexo 6. 关联 Hexo 与 GitHub Pages 6.1 生成SSH Keys 6.2 添加 SSH Key 到 GitHub 6.3 测试 6.4 配置信息 7. Hexo 的常用操作 8. Hexo 主题 9. 解决多端同步问题 10. 后话 11. 参考 1. 前言对于一个强迫症患者来说，搭建个人博客是一件让人抓狂的事情。四处寻找主题，有的是功能不全，没有分类和标签；有的是样式太随便，字体和布局都不大满意，对于一个不熟悉前端的人来说，修改样式有点费时间；还有就是环境问题，很多教程都是博客老手写出来的，有些细节点并没有很好的说明。仅以此文记录自己在 macOS环境 中安装的步骤和遇到的问题，如有其它问题欢迎交流。 2. 搭建步骤这次介绍的是使用 Hexo + GitHub Pages 搭建个人博客。Hexo是基于Nodejs的框架，一个快速、简洁且高效的博客框架。Hexo 使用 Markdown（或其他渲染引擎）解析文章，在几秒内，即可利用靓丽的主题生成静态网页。再使用GitHub托管就能免费搭建个人博客。 123456781. 搭建 Node.js 环境2. 搭建 Git 环境3. GitHub 注册和配置4. 安装配置 Hexo5. 关联 Hexo 与 GitHub Pages6. Hexo 的常用操作7. Hexo 主题8. 解决多端同步问题 3. 搭建 Node.js 环境前面说过Hexo是基于Nodejs的，所以必须要搭建Nodejs的环境，其中包括安装Nodejs编译环境和npm（JavaScript包管理工具）。搭建Nodejs环境的方法五花八门，不过可以大致分成几类： a. 下载Nodejs安装包，直接安装； 英文地址https://nodejs.org/en/； 中文地址http://nodejs.cn/download/。 b. 从克隆或者下载源码编译安装 使用命令$ sudo git clone https://github.com/nodejs/node.git将源码克隆到本地； 修改目录权限$ sudo chmod -R 755 node； 先后执行一下命令完成编译安装： 12345$ cd node$ sudo ./configure$ sudo make$ sudo make install$ node --version c. 利用包brew等管理工具安装，brew是macOS下的一个软件管理工具，因为网络长城和其他环境原因安装起来并不简单，可能需要换国内镜像，但是国内镜像也有出问题的时候，遇到问题还需要google 安装brew 1/usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot; 安装node和npm brew install node --with-npm 查看安装是否成功 12$ node -v$ npm -v 4. 搭建Git环境 &amp; GitHub注册和配置&ensp;&ensp;在macOS里面安装了Xcode就会附带安装Git，同时还有下载安装包和管理工具两种方式，这里附带下载地址http://git-scm.com/downloads，不做过多说明。 &ensp;&ensp;在GitHub（https://github.com/）注册一个账号就不用过多说明。&ensp;&ensp;配置就是要去建一个GitHub Pages的仓库，在GitHub Pages的主页是一句这样的介绍：Websites for you and your projects. 就是GitHub提供的一个存放静态网站的仓库，和普通仓库的区别就是它还能通过 https://username.github.io 域名来访问到这个网站。并没什么具体的步骤，只需要新建一个repository名字为username.github.io。 username一定要是你的用户名！ username一定要是你的用户名！ username一定要是你的用户名！ 5. 安装配置 Hexo 官网就有安装步骤，有时间可以去看下https://hexo.io/zh-cn/ 用npm安装hexo：npm install hexo-cli -g 安装完成查看版本信息，验证是否安装成功：hexo version 接下来就是配置你的个人博客 12345678910# 在本地创建一个hexo项目存放在username.github.io，这个和之前创建的仓库名一致$ hexo init username.github.io# 进入文件夹$ cd username.github.io# 把需要的依赖环境都自动装上$ npm install# 安装部署模块，有了这个模块才能使用 hexo d 部署到仓库中去，后面会讲$ npm install hexo-deployer-git --save# 安装启动服务模块，有了它才能在本地运行，预览效果$ npm install hexo-server --save 本地运行博客，预览效果 123$ hexo server或者$ hexo s 图1、博客的艰难部署过程/预览效果图 6. 关联 Hexo 与 GitHub Pages经过上一章节的操作，已经能够在本地写文章并且预览，现在就是要关联之前创建的GitHub Pages仓库，这样我就可以通过username.github.io 域名去访问。 6.1 生成SSH Keys输入一下命令，自己的邮箱地址&quot;xxxxxxxxxx@mail.com&quot;，ssh-keygen -t rsa表示我们指定 RSA 算法生成密钥。 $ ssh-keygen -t rsa -C &quot;xxxxxxxxxx@mail.com&quot; 执行后会要求输入密码，密码的话需要6位数以上，没有什么具体要求，不输入则是不需要密码。之后就就会生成两个文件，分别为id_rsa和id_rsa.pub，即密钥id_rsa和公钥id_rsa.pub。 6.2 添加 SSH Key 到 GitHub图2、添加SSH Key 首先要在个人GitHub的setting-&gt;SSH and GPG Keys(https://github.com/settings/ssh)中New SSH Key，在macOS中找到~/.ssh/id_rsa.pub，将id_rsa.pub中的内容复制到新建SSH Key的Key框中，点击ADD SSH Key即可。 6.3 测试执行以下命令查看是添加成功： 1$ ssh -T git@github.com 第一次执行clone或者push会有如下警告： 123The authenticity of host &apos;github.com (xx.xx.xx.xx)&apos; can&apos;t be established.RSA key fingerprint is xx.xx.xx.xx.xx.Are you sure you want to continue connecting (yes/no)? 这是因为Git使用SSH连接，而SSH连接在第一次验证GitHub服务器的Key时，需要你确认GitHub的Key的指纹信息是否真的来自GitHub的服务器，输入yes回车即可，得到一下信息即已经添加成功。 1Hi aierui! You&apos;ve successfully authenticated, but GitHub does not provide shell access. 6.4 配置信息Git 会根据用户的名字和邮箱来记录提交。GitHub 也是用这些信息来做权限的处理，输入下面的代码进行个人信息的设置，把名称和邮箱替换成你自己的。 12$ git config --global user.name &quot;username&quot;$ git config --global user.email &quot;xxxxx@mail.com&quot; 在博客更目录_config.yml文件中，找到Deployment，然后按照如下修改，用户名改成你的： 需要注意的是冒号后面记得空一格！ 123456# Deployment## Docs: https://hexo.io/docs/deployment.htmldeploy: type: git repo: git@github.com:username/username.github.io.git branch: master 7. Hexo 的常用操作结束了上面的配置，就可以开始写文章、渲染、发布，涉及的操作有： 123456789101112131415161718# 新建文章$ hexo new &quot;postName&quot;# 清除旧的发布文件$ hexo clean# 生成发布文件$ hexo generate或者$ hexo g# 本地预览hexo s# 发布$ hexo deploye或者$ hexo d 如果发布成功，就可以用 username.github.io 访问到你的博客，如果有自己的域名也可以配置成你的域名来访问，具体参考中的《可能是最详细的 Hexo + GitHub Pages 搭建博客的教程》有介绍。如果遇到错误，不妨看下以下几个问题。 注意1：发布前要安装发布扩张 1$ npm install hexo-deployer-git --save 注意2：如果在执行 hexo d 后,出现 error deployer not found:github 的错误（如下），则是因为没有设置好 public key 所致，重新详细设置即可。 1234Permission denied (publickey).fatal: Could not read from remote repository.Please make sure you have the correct access rightsand the repository exists. 注意3：怎么避免 .md 文件被解析？ Hexo原理就是hexo在执行hexo generate时会在本地先把博客生成的一套静态站点放到public文件夹中，在执行hexo deploy时将其复制到.deploy文件夹中。Github的版本库通常建议同时附上README.md说明文件，但是hexo默认情况下会把所有md文件解析成html文件，所以即使你在线生成了 README. md，它也会在你下一次部署时被删去。怎么解决呢？ 在执行hexo deploy前把在本地写好的README.md文件复制到.deploy文件夹中，再去执行hexo deploy。 8. Hexo 主题官方主题库：https://hexo.io/themes/ 主题是五花八门的，真正合心意的可能没几个，需要自己慢慢寻找。 纠结了很久之后用了https://github.com/shenliyang/hexo-theme-snippet这款。 123456789# 克隆主题到博客目录的themes/snippet文件夹下git clone git://github.com/shenliyang/hexo-theme-snippet.git themes/snippet# 安装主题渲染依赖插件npm install hexo-renderer-ejs --savenpm install hexo-renderer-less --save# 本地搜索支持插件npm install hexo-generator-json-content@2.2.0 -S 然后修改_config.yml中的theme: snippet，其他的配置可以看参考作者的GitHub，执行$ hexo clean、$ hexo generate、$ hexo s即可预览到修改主题后的效果，效果满意就可以进行发布。如果修改了某一个配置不起作用，不妨查看下是不是需要什么插件支持，对应地去安装插件。 9. 解决多端同步问题使用$ hexo d，将博客发布后，在GitHub仓库里就会发现，仓库只剩下hexo渲染后的静态网站，hexo和主题的代码都没有了，也许是因为hexo不想代码太混乱吧。这样的情况就会有个问题，我想在其他地方写文章或者换了部电脑，之前那些本地文件没有备份的话就得重头搭建了。解决这个问题有两种方法，一种是创建另外一个仓库存代码，不过这种方法总觉得很多余；所以第二种就是在原来的仓库新建一个分支，hexo命令来发布主干上的网站，git在分支上同步各端。 本地新建分支同步GitHub仓库 1234567891011121314151617181920# 初始化本地仓库（前面已创建可忽略）$ git init # 将必要的文件依次添加$ git add . # 提交修改$ git commit -m &quot;branch Hexo&quot;# 新建hexo分支$ git branch hexo # 切换到hexo分支上$ git checkout hexo # 将本地与Github项目对接（前面已执行可忽略）$ git remote add origin git@github.com:username/username.github.io.git # push到Github项目的hexo分支上$ git push origin hexo 在另一个电脑clone分支的代码 123456789101112131415161718192021# 将Github中hexo分支clone到本地$ git clone -b hexo git@github.com:username/username.github.io.git # 切换到刚刚clone的文件夹内$ cd username.github.io # 注意，这里一定要切换到刚刚clone的文件夹内执行，安装必要的所需组件，不用再init$ npm install # 新建一个.md文件，并编辑完成自己的博客内容$ hexo new post &quot;new blog name&quot; # 经测试每次只要更新sorcerer中的文件到Github中即可，因为只是新建了一篇新博客$ git add source $ git commit -m &quot;XX&quot;# 更新分支$ git push origin hexo # push更新完分支之后将自己写的博客对接到自己搭的博客网站上，同时同步了Github中的master$ hexo d -g 10. 后话GitHub Pages默认支持Jekyll+GitHub Pages的搭建，介绍：http://www.jekyll.com.cn/；搭建起来会更加简单些，折腾过才知道哪个更适合自己。 11. 参考 《可能是最详细的 Hexo + GitHub Pages 搭建博客的教程》 《hexo 博客搭建》 《hexo主题安装》 《如何解决github+Hexo的博客多终端同步问题》","categories":[{"name":"工具","slug":"工具","permalink":"https://zealforbeing.github.io/categories/工具/"}],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://zealforbeing.github.io/tags/macOS/"},{"name":"Nodejs","slug":"Nodejs","permalink":"https://zealforbeing.github.io/tags/Nodejs/"}],"keywords":[{"name":"工具","slug":"工具","permalink":"https://zealforbeing.github.io/categories/工具/"}]}]}